# Copyright 2024 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
# Blueprint metadata that is used by blueprint-ui and other tools.
apiVersion: blueprints.cloud.google.com/v1alpha1
kind: BlueprintMetadata
metadata:
  name: terraform-google-iam-bindings
  source:
    type: git
    location: github.com/GoogleCloudPlatform/terraform-google-iam-bindings
  version: 1.0.0
  actuationTool:
    type: Terraform
    version:
    - ">= 1.3.0"
  title: IAM Authoritative Bindings
  description:
    tagline: A module for managing authoritative IAM bindings on various GCP resources.
    detailed: |
      This module manages authoritative IAM bindings for various Google Cloud resource types. An IAM binding is authoritative for a given role, meaning it will overwrite any existing members for that role on the resource. If you want to add a member to a role without affecting existing members, use the `IAM_Access_Members` component instead.
      This module supports creating bindings at the following levels:
      - Project
      - Folder
      - Organization
      - Billing Account
      - Service Account
      - Storage Bucket
  labels:
    gcp.ca.module.category: Security & Identity
  examples:
  - name: simple_project_binding_example
    location: examples/simple_project_binding
    title: Simple Project IAM Binding Example
  - name: conditional_iam_binding_example
    location: examples/conditional_iam_binding
    title: Conditional IAM Binding Example
spec:
  requirements:
    roles:
    - level: Project
      role: roles/resourcemanager.projectIamAdmin
    - level: Folder
      role: roles/resourcemanager.folderIamAdmin
    - level: Organization
      role: roles/resourcemanager.organizationAdmin
    - level: Billing
      role: roles/billing.admin
    - level: Project
      role: roles/iam.serviceAccountAdmin
    - level: Project
      role: roles/storage.admin
    services:
    - cloudresourcemanager.googleapis.com
    - cloudbilling.googleapis.com
    - iam.googleapis.com
    - storage.googleapis.com
  interfaces:
    variables:
    - name: project_bindings
      description: A map of IAM bindings for projects. The key is a logical name for the binding. The value is an object with the project ID, role, a list of members, and an optional condition.
      type: map
      default: {}
      required: false
    - name: folder_bindings
      description: A map of IAM bindings for folders. The key is a logical name for the binding. The value is an object with the folder ID (e.g., 'folders/12345'), role, a list of members, and an optional condition.
      type: map
      default: {}
      required: false
    - name: organization_bindings
      description: A map of IAM bindings for an organization. The key is a logical name for the binding. The value is an object with the organization ID, role, a list of members, and an optional condition.
      type: map
      default: {}
      required: false
    - name: billing_account_bindings
      description: A map of IAM bindings for a billing account. The key is a logical name for the binding. The value is an object with the billing account ID, role, a list of members, and an optional condition.
      type: map
      default: {}
      required: false
    - name: service_account_bindings
      description: A map of IAM bindings for a service account. The key is a logical name for the binding. The value is an object with the service account ID (in the form 'projects/{project}/serviceAccounts/{email}'), role, a list of members, and an optional condition.
      type: map
      default: {}
      required: false
    - name: storage_bucket_bindings
      description: A map of IAM bindings for a storage bucket. The key is a logical name for the binding. The value is an object with the bucket name (without 'gs://'), role, a list of members, and an optional condition.
      type: map
      default: {}
      required: false
    variableGroups:
    - title: Project IAM Bindings
      description: Configure authoritative IAM bindings at the project level.
      variables:
      - project_bindings
    - title: Folder IAM Bindings
      description: Configure authoritative IAM bindings at the folder level.
      variables:
      - folder_bindings
    - title: Organization IAM Bindings
      description: Configure authoritative IAM bindings at the organization level.
      variables:
      - organization_bindings
    - title: Billing Account IAM Bindings
      description: Configure authoritative IAM bindings at the billing account level.
      variables:
      - billing_account_bindings
    - title: Service Account IAM Bindings
      description: Configure authoritative IAM bindings for a specific service account.
      variables:
      - service_account_bindings
    - title: Storage Bucket IAM Bindings
      description: Configure authoritative IAM bindings for a specific storage bucket.
      variables:
      - storage_bucket_bindings
    outputs:
    - name: project_bindings_ids
      description: A map of the full resource IDs for the created project IAM bindings. The keys are the logical names of the bindings.
    - name: folder_bindings_ids
      description: A map of the full resource IDs for the created folder IAM bindings. The keys are the logical names of the bindings.
    - name: organization_bindings_ids
      description: A map of the full resource IDs for the created organization IAM bindings. The keys are the logical names of the bindings.
    - name: billing_account_bindings_ids
      description: A map of the full resource IDs for the created billing account IAM bindings. The keys are the logical names of the bindings.
    - name: service_account_bindings_ids
      description: A map of the full resource IDs for the created service account IAM bindings. The keys are the logical names of the bindings.
    - name: storage_bucket_bindings_ids
      description: A map of the full resource IDs for the created storage bucket IAM bindings. The keys are the logical names of the bindings.
